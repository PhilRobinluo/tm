#!/bin/bash
# tm-cheat - tmux 速查卡（分区菜单版）
# 不需要滚动，按数字选分区，按 q 退出

show_menu() {
    clear
    cat <<'EOF'

  ⌨️  tmux 速查卡
  ════════════════════════════════════════

  [1] 📌 日常必备（先记这 4 个就够了）
  [2] 🪟 窗口管理（像浏览器标签页）
  [3] 🔲 分屏操作（一屏干两件事）
  [4] 📜 翻页 & 复制粘贴
  [5] 📌 会话管理
  [6] 🧠 助记口诀（全部命令速记）

  ════════════════════════════════════════
  按数字选择    q 退出
EOF
}

show_section() {
    clear
    case $1 in
    1)
        cat <<'EOF'

  📌 日常必备（先记住这 4 个就够了）
  ════════════════════════════════════════

  我想离开，但任务别停
    → Ctrl+B 松开 按 d
    💬 d = Detach（脱离，人走了但活还在干）

  我想回来接着干
    → 终端输入 tm a
    💬 a = Attach（接上，重新连回去）

  我想开一个新窗口
    → Ctrl+B 松开 按 c
    💬 c = Create（创建一个新的）

  我想切换窗口
    → Ctrl+B 松开 按 n（下一个）
    → Ctrl+B 松开 按 p（上一个）
    💬 n = Next  p = Previous

  ════════════════════════════════════════
  回车返回    q 退出
EOF
        ;;
    2)
        cat <<'EOF'

  🪟 窗口管理（像浏览器标签页）
  ════════════════════════════════════════

  窗口太多，弹出列表直接选
    → Ctrl+B 松开 按 w
    💬 w = Window（上下选，回车跳）

  给窗口起个名字，方便识别
    → Ctrl+B 松开 按 ,（逗号）
    💬 逗号 = 就像句子里插一个备注

  跳到第 N 个窗口
    → Ctrl+B 松开 按 数字（0-9）
    💬 第几个窗口就按几

  关掉当前窗口
    → 直接输入 exit 回车
    💬 跟关终端一样

  ════════════════════════════════════════
  回车返回    q 退出
EOF
        ;;
    3)
        cat <<'EOF'

  🔲 分屏（一个屏幕干两件事）
  ════════════════════════════════════════

  上下分屏
    → Ctrl+B 松开 按 "（双引号）
    💬 " 是横线，屏幕被横着切一刀

  左右分屏
    → Ctrl+B 松开 按 %
    💬 % 中间有竖线，屏幕被竖着切一刀

  在分屏之间跳
    → Ctrl+B 松开 按 方向键 ↑↓←→
    💬 想去哪边就按哪边

  当前分屏全屏（看长输出超好用）
    → Ctrl+B 松开 按 z
    💬 z = Zoom（再按一次缩回去）

  调整分屏大小
    → Ctrl+B 按住不放 按方向键
    💬 唯一一个不松开的操作

  关掉当前分屏
    → Ctrl+B 松开 按 x
    💬 x = 叉掉（确认按 y）

  ════════════════════════════════════════
  回车返回    q 退出
EOF
        ;;
    4)
        cat <<'EOF'

  📜 翻页 & 复制粘贴
  ════════════════════════════════════════

  鼠标/触控板直接滑动就能翻
    💬 已开启 mouse on，最简单的方式

  键盘翻页
    → Ctrl+B 松开 按 [
    → 上下方向键翻，按 q 退出
    💬 [ 像打开一本书，q 合上

  简单复制：鼠标选中自动复制
    → Cmd+V 粘贴
    💬 跟平时一样

  键盘复制（精确选择）
    → Ctrl+B 按 [       进入选择模式
    → 方向键到起点 按 空格  开始选
    → 方向键到终点 按 回车  复制完成
    → Ctrl+B 按 ]       粘贴
    💬 [ 开始选  ] 粘贴出来

  ════════════════════════════════════════
  回车返回    q 退出
EOF
        ;;
    5)
        cat <<'EOF'

  📌 会话管理
  ════════════════════════════════════════

  看所有会话，直接切换
    → Ctrl+B 松开 按 s
    💬 s = Sessions（上下选回车切）

  给当前会话改名
    → Ctrl+B 松开 按 $
    💬 $ = 值钱的东西要有名字

  ════════════════════════════════════════

  💡 记不住？

  弹出这个速查卡
    → Ctrl+B 松开 按 h
    💬 h = Help（救命！）

  打开完整管理菜单
    → 终端输入 tm

  快捷命令
    → tm a     进入已有会话
    → tm new   创建新会话
    → tm ls    查看所有会话
    → tm keys  快捷键教学

  ════════════════════════════════════════
  回车返回    q 退出
EOF
        ;;
    6)
        cat <<'EOF'

  🧠 助记口诀
  ════════════════════════════════════════

  d 脱离  c 创建  n 下个  p 上个
  w 窗口  s 会话  z 放大  x 叉掉
  h 救命  [ 翻书  " 横切  % 竖切

  ════════════════════════════════════════

  规则：所有操作都是 Ctrl+B 松开 再按键
  唯一例外：调整分屏大小 Ctrl+B 按住不放

  ════════════════════════════════════════

  💡 联想记忆法

  d → Detach  人走茶不凉
  c → Create  造一个新世界
  n → Next    翻到下一页
  p → Previous 翻回上一页
  w → Window  打开窗户看全景
  s → Session 切换工作桌
  z → Zoom    放大镜看仔细
  x → ✕      画个叉关掉
  h → Help    求救信号
  [ → 翻开书  看历史记录
  " → 横线    横刀一切两半
  % → 竖线    竖刀一劈两半

  ════════════════════════════════════════
  回车返回    q 退出
EOF
        ;;
    esac
}

# 主循环
while true; do
    show_menu
    read -n1 -s key
    case $key in
        q|Q) clear; exit 0 ;;
        [1-6])
            show_section "$key"
            while true; do
                read -n1 -s sub_key
                case $sub_key in
                    q|Q) clear; exit 0 ;;
                    *) break ;;
                esac
            done
            ;;
    esac
done
